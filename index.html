<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enrollment Progress Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .lucide { width: 1em; height: 1em; stroke: currentColor; fill: none; stroke-width: 2; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // Lucide icons
        const CheckCircle = ({className}) => React.createElement('svg', {className: className + ' lucide', viewBox: '0 0 24 24'}, React.createElement('path', {d: 'M22 11.08V12a10 10 0 1 1-5.93-9.14'}), React.createElement('polyline', {points: '22,4 12,14.01 9,11.01'}));
        const Circle = ({className}) => React.createElement('svg', {className: className + ' lucide', viewBox: '0 0 24 24'}, React.createElement('circle', {cx: '12', cy: '12', r: '10'}));
        const Clock = ({className}) => React.createElement('svg', {className: className + ' lucide', viewBox: '0 0 24 24'}, React.createElement('circle', {cx: '12', cy: '12', r: '10'}), React.createElement('polyline', {points: '12,6 12,12 16,14'}));
        const Settings = ({className}) => React.createElement('svg', {className: className + ' lucide', viewBox: '0 0 24 24'}, React.createElement('circle', {cx: '12', cy: '12', r: '3'}), React.createElement('path', {d: 'm12 1 1.42 1.42L16 3.83l1.42-1.42L19 4l-1.42 1.42L16.17 8l1.42 1.42L16 11l-1.42-1.42L12 8.17l-1.42 1.42L9 8l1.42-1.42L8.83 4l-1.42 1.42L6 4l1.42-1.42L8.83 1l1.42 1.42z'}));
        const Github = ({className}) => React.createElement('svg', {className: className + ' lucide', viewBox: '0 0 24 24', fill: 'currentColor'}, React.createElement('path', {d: 'M12 0C5.37 0 0 5.37 0 12c0 5.31 3.44 9.8 8.21 11.39.6.11.82-.26.82-.58v-2.03c-3.34.73-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.09-.75.08-.73.08-.73 1.21.09 1.85 1.24 1.85 1.24 1.07 1.84 2.81 1.31 3.49 1 .11-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.12-.3-.54-1.52.12-3.18 0 0 1.01-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.29-1.55 3.3-1.23 3.3-1.23.66 1.66.24 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.8 5.63-5.48 5.92.43.37.81 1.1.81 2.22v3.29c0 .32.22.7.83.58C20.56 21.8 24 17.31 24 12c0-6.63-5.37-12-12-12z'}));
        const Edit2 = ({className}) => React.createElement('svg', {className: className + ' lucide', viewBox: '0 0 24 24'}, React.createElement('path', {d: 'm15 5 4 4'}), React.createElement('path', {d: 'M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13'}), React.createElement('path', {d: 'm8 6 2-2'}), React.createElement('path', {d: 'm2 22 5.5-1.5L21.17 6.83a2.82 2.82 0 0 0-4-4L3.5 16.5Z'}), React.createElement('path', {d: 'm18 16 2-2'}), React.createElement('path', {d: 'm17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17'}));
        const Save = ({className}) => React.createElement('svg', {className: className + ' lucide', viewBox: '0 0 24 24'}, React.createElement('path', {d: 'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z'}), React.createElement('polyline', {points: '17,21 17,13 7,13 7,21'}), React.createElement('polyline', {points: '7,3 7,8 15,8'}));
        const X = ({className}) => React.createElement('svg', {className: className + ' lucide', viewBox: '0 0 24 24'}, React.createElement('path', {d: 'M18 6 6 18'}), React.createElement('path', {d: 'm6 6 12 12'}));

        const GitHubProgressTracker = () => {
            const [expandedEpics, setExpandedEpics] = React.useState({});
            const [editingFeature, setEditingFeature] = React.useState(null);
            const [epics, setEpics] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [syncing, setSyncing] = React.useState(false);
            const [showSettings, setShowSettings] = React.useState(false);
            const [gitHubConfig, setGitHubConfig] = React.useState({
                token: '',
                owner: '',
                repo: '',
                branch: 'main',
                filename: 'progress-data.json'
            });
            const [syncStatus, setSyncStatus] = React.useState('');

            // Default epic data
            const defaultEpics = [
                {
                    id: 'epic-001',
                    number: 'Enrollment-001',
                    name: 'AccountCreation',
                    description: 'Enable secure client onboarding and access management',
                    journey: 'REGISTER',
                    status: 'completed',
                    notes: 'Epic v1.3 completed - Consolidated into single feature document',
                    mvp1Features: [{
                        number: 'Enrollment-001.001',
                        name: 'GuidedOnboardingAccess',
                        description: 'Account creation, login with unique ID, organization pre-population',
                        stories: 25,
                        status: 'completed',
                        notes: 'Consolidated with 001.002 into single comprehensive feature document'
                    }],
                    mvp2Features: []
                },
                // Add more epics here if needed, or keep it simple for now
            ];

            React.useEffect(() => {
                loadConfigAndData();
            }, []);

            const loadConfigAndData = async () => {
                const savedConfig = localStorage.getItem('github-tracker-config');
                if (savedConfig) {
                    const config = JSON.parse(savedConfig);
                    setGitHubConfig(config);
                    await loadFromGitHub(config);
                } else {
                    setEpics(defaultEpics);
                    setLoading(false);
                }
            };

            const saveConfig = () => {
                localStorage.setItem('github-tracker-config', JSON.stringify(gitHubConfig));
                setSyncStatus('Configuration saved locally');
                setTimeout(() => setSyncStatus(''), 3000);
            };

            const loadFromGitHub = async (config = gitHubConfig) => {
                if (!config.token || !config.owner || !config.repo) {
                    setEpics(defaultEpics);
                    setLoading(false);
                    return;
                }

                setSyncing(true);
                try {
                    const response = await fetch(
                        `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.filename}?ref=${config.branch}`,
                        {
                            headers: {
                                'Authorization': `token ${config.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );

                    if (response.ok) {
                        const data = await response.json();
                        const content = JSON.parse(atob(data.content));
                        setEpics(content.epics || defaultEpics);
                        setSyncStatus('✅ Loaded from GitHub');
                    } else {
                        setEpics(defaultEpics);
                        await saveToGitHub(defaultEpics, config);
                        setSyncStatus('📝 Created new progress file on GitHub');
                    }
                } catch (error) {
                    console.error('Error loading from GitHub:', error);
                    setEpics(defaultEpics);
                    setSyncStatus('❌ Failed to load from GitHub');
                }
                
                setSyncing(false);
                setLoading(false);
                setTimeout(() => setSyncStatus(''), 5000);
            };

            const saveToGitHub = async (epicsData = epics, config = gitHubConfig) => {
                if (!config.token || !config.owner || !config.repo) {
                    setSyncStatus('❌ GitHub configuration required');
                    setTimeout(() => setSyncStatus(''), 3000);
                    return;
                }

                setSyncing(true);
                try {
                    let sha = null;
                    try {
                        const getResponse = await fetch(
                            `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.filename}?ref=${config.branch}`,
                            {
                                headers: {
                                    'Authorization': `token ${config.token}`,
                                    'Accept': 'application/vnd.github.v3+json'
                                }
                            }
                        );
                        if (getResponse.ok) {
                            const fileData = await getResponse.json();
                            sha = fileData.sha;
                        }
                    } catch (e) {
                        // File doesn't exist yet
                    }

                    const dataToSave = {
                        epics: epicsData,
                        lastUpdated: new Date().toISOString(),
                        version: '1.0'
                    };

                    const content = btoa(JSON.stringify(dataToSave, null, 2));
                    
                    const body = {
                        message: `Update progress tracker - ${new Date().toLocaleString()}`,
                        content: content,
                        branch: config.branch
                    };

                    if (sha) {
                        body.sha = sha;
                    }

                    const response = await fetch(
                        `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.filename}`,
                        {
                            method: 'PUT',
                            headers: {
                                'Authorization': `token ${config.token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(body)
                        }
                    );

                    if (response.ok) {
                        setSyncStatus('✅ Saved to GitHub');
                    } else {
                        const error = await response.json();
                        setSyncStatus(`❌ Save failed: ${error.message}`);
                    }
                } catch (error) {
                    console.error('Error saving to GitHub:', error);
                    setSyncStatus('❌ Failed to save to GitHub');
                }
                
                setSyncing(false);
                setTimeout(() => setSyncStatus(''), 5000);
            };

            const updateFeatureStatus = async (epicId, featureNumber, newStatus, mvpType) => {
                const updatedEpics = epics.map(epic => {
                    if (epic.id === epicId) {
                        const updateFeatures = (features) => 
                            features.map(feature => 
                                feature.number === featureNumber 
                                    ? { ...feature, status: newStatus }
                                    : feature
                            );

                        const updatedEpic = {
                            ...epic,
                            mvp1Features: mvpType === 'mvp1' ? updateFeatures(epic.mvp1Features) : epic.mvp1Features,
                            mvp2Features: mvpType === 'mvp2' ? updateFeatures(epic.mvp2Features) : epic.mvp2Features
                        };

                        // Auto-update epic status
                        const allFeatures = [...updatedEpic.mvp1Features, ...updatedEpic.mvp2Features];
                        const completedFeatures = allFeatures.filter(f => f.status === 'completed');
                        const inProgressFeatures = allFeatures.filter(f => f.status === 'in-progress');
                        
                        if (completedFeatures.length === allFeatures.length && allFeatures.length > 0) {
                            updatedEpic.status = 'completed';
                        } else if (completedFeatures.length > 0 || inProgressFeatures.length > 0) {
                            updatedEpic.status = 'in-progress';
                        } else {
                            updatedEpic.status = 'not-started';
                        }

                        return updatedEpic;
                    }
                    return epic;
                });

                setEpics(updatedEpics);
                await saveToGitHub(updatedEpics);
            };

            const getStatusIcon = (status) => {
                switch(status) {
                    case 'completed':
                        return React.createElement(CheckCircle, {className: 'w-5 h-5 text-green-600'});
                    case 'in-progress':
                        return React.createElement(Clock, {className: 'w-5 h-5 text-blue-600'});
                    case 'not-started':
                        return React.createElement(Circle, {className: 'w-5 h-5 text-gray-400'});
                    default:
                        return React.createElement(Circle, {className: 'w-5 h-5 text-gray-400'});
                }
            };

            const getStatusColor = (status) => {
                const colors = {
                    'completed': 'bg-green-100 text-green-800',
                    'in-progress': 'bg-blue-100 text-blue-800',
                    'not-started': 'bg-gray-100 text-gray-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            };

            const calculateProgress = () => {
                const allFeatures = epics.flatMap(e => [...e.mvp1Features, ...e.mvp2Features]);
                const completed = allFeatures.filter(f => f.status === 'completed').length;
                const total = allFeatures.length;
                return { completed, total, percentage: Math.round((completed / total) * 100) };
            };

            if (loading) {
                return React.createElement('div', {className: 'max-w-7xl mx-auto p-6 bg-gray-50'},
                    React.createElement('div', {className: 'flex items-center justify-center h-64'},
                        React.createElement('div', {className: 'text-lg text-gray-600'}, 'Loading progress tracker...')
                    )
                );
            }

            const progress = calculateProgress();

            return React.createElement('div', {className: 'max-w-7xl mx-auto p-6 bg-gray-50'},
                // Header
                React.createElement('div', {className: 'bg-white rounded-lg shadow-sm p-6 mb-6'},
                    React.createElement('div', {className: 'flex items-center justify-between mb-4'},
                        React.createElement('div', null,
                            React.createElement('h1', {className: 'text-3xl font-bold text-gray-900 mb-2'}, 'Enrollment MVP 1 & 2 Progress Tracker'),
                            React.createElement('p', {className: 'text-gray-600'}, 'Epic, Feature, and User Story mapping for MVP releases (GitHub-Enabled)')
                        ),
                        React.createElement('div', {className: 'flex items-center space-x-2'},
                            React.createElement('button', {
                                onClick: () => setShowSettings(!showSettings),
                                className: 'p-2 text-gray-600 hover:bg-gray-100 rounded-lg'
                            }, React.createElement(Settings, {className: 'w-5 h-5'})),
                            React.createElement('button', {
                                onClick: () => loadFromGitHub(),
                                disabled: syncing,
                                className: 'p-2 text-blue-600 hover:bg-blue-50 rounded-lg disabled:opacity-50'
                            }, React.createElement(Github, {className: `w-5 h-5 ${syncing ? 'animate-spin' : ''}`}))
                        )
                    ),

                    // Sync Status
                    syncStatus && React.createElement('div', {className: 'mb-4 p-2 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800'}, syncStatus),

                    // Settings Panel
                    showSettings && React.createElement('div', {className: 'mb-4 p-4 bg-gray-50 border rounded-lg'},
                        React.createElement('h3', {className: 'font-semibold mb-3'}, 'GitHub Configuration'),
                        React.createElement('div', {className: 'grid grid-cols-1 md:grid-cols-2 gap-4'},
                            React.createElement('div', null,
                                React.createElement('label', {className: 'block text-sm font-medium text-gray-700 mb-1'}, 'Personal Access Token'),
                                React.createElement('input', {
                                    type: 'password',
                                    value: gitHubConfig.token,
                                    onChange: (e) => setGitHubConfig({...gitHubConfig, token: e.target.value}),
                                    className: 'w-full p-2 border rounded text-sm',
                                    placeholder: 'ghp_...'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', {className: 'block text-sm font-medium text-gray-700 mb-1'}, 'Repository Owner'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: gitHubConfig.owner,
                                    onChange: (e) => setGitHubConfig({...gitHubConfig, owner: e.target.value}),
                                    className: 'w-full p-2 border rounded text-sm',
                                    placeholder: 'your-username'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', {className: 'block text-sm font-medium text-gray-700 mb-1'}, 'Repository Name'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: gitHubConfig.repo,
                                    onChange: (e) => setGitHubConfig({...gitHubConfig, repo: e.target.value}),
                                    className: 'w-full p-2 border rounded text-sm',
                                    placeholder: 'enrollment-progress-tracker'
                                })
                            )
                        ),
                        React.createElement('div', {className: 'mt-4 flex items-center space-x-2'},
                            React.createElement('button', {
                                onClick: saveConfig,
                                className: 'px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700'
                            }, 'Save Config'),
                            React.createElement('button', {
                                onClick: () => loadFromGitHub(),
                                disabled: syncing,
                                className: 'px-3 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700 disabled:opacity-50'
                            }, syncing ? 'Syncing...' : 'Load from GitHub')
                        )
                    ),

                    // Progress Bar
                    React.createElement('div', {className: 'bg-blue-50 rounded-lg p-4'},
                        React.createElement('div', {className: 'flex items-center justify-between mb-2'},
                            React.createElement('span', {className: 'text-sm font-semibold text-gray-700'}, 'Overall Progress'),
                            React.createElement('span', {className: 'text-sm font-semibold text-blue-700'}, 
                                `${progress.completed} of ${progress.total} features completed (${progress.percentage}%)`
                            )
                        ),
                        React.createElement('div', {className: 'w-full bg-gray-200 rounded-full h-3'},
                            React.createElement('div', {
                                className: 'bg-blue-600 h-3 rounded-full transition-all duration-500',
                                style: { width: `${progress.percentage}%` }
                            })
                        )
                    )
                ),

                // Epics List
                React.createElement('div', {className: 'space-y-4'},
                    epics.map((epic) => 
                        React.createElement('div', {key: epic.id, className: 'bg-white rounded-lg shadow-sm border'},
                            React.createElement('div', {className: 'p-4'},
                                React.createElement('div', {className: 'flex items-center space-x-3'},
                                    getStatusIcon(epic.status),
                                    React.createElement('div', null,
                                        React.createElement('div', {className: 'flex items-center space-x-2'},
                                            React.createElement('h3', {className: 'text-lg font-semibold text-gray-900'}, 
                                                `${epic.number}: ${epic.name}`
                                            ),
                                            React.createElement('span', {className: `px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(epic.status)}`},
                                                epic.status.replace('-', ' ')
                                            )
                                        ),
                                        React.createElement('p', {className: 'text-gray-600 text-sm'}, epic.description),
                                        React.createElement('div', {className: 'flex items-center space-x-4 mt-1'},
                                            React.createElement('span', {className: 'text-xs text-gray-500'}, `Journey: ${epic.journey}`),
                                            React.createElement('span', {className: 'text-xs text-gray-500'}, 
                                                `MVP1: ${epic.mvp1Features.length} features | MVP2: ${epic.mvp2Features.length} features`
                                            )
                                        ),
                                        epic.notes && React.createElement('p', {className: 'text-xs text-blue-600 italic mt-1'}, epic.notes)
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(GitHubProgressTracker), document.getElementById('root'));
    </script>
</body>
</html>
