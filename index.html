<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Enrollment Progress Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better visual feedback */
        .epic-status-transition {
            transition: all 0.3s ease-in-out;
        }
        .status-button-hover:hover {
            transform: scale(1.05);
            transition: transform 0.2s ease;
        }
        .progress-bar-animate {
            transition: width 0.5s ease-in-out;
        }
        
        /* Custom icon styles to replace Lucide */
        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
            vertical-align: middle;
        }
        
        .icon-completed {
            background: #16a34a;
            border-radius: 50%;
            position: relative;
        }
        
        .icon-completed::after {
            content: '‚úì';
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
        }
        
        .icon-in-progress {
            background: #2563eb;
            border-radius: 50%;
            position: relative;
        }
        
        .icon-in-progress::after {
            content: '‚óã';
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
        }
        
        .icon-not-started {
            background: #9ca3af;
            border-radius: 50%;
            border: 2px solid #d1d5db;
        }
        
        .icon-chevron-down::after {
            content: '‚ñº';
            font-size: 12px;
            color: #6b7280;
        }
        
        .icon-chevron-right::after {
            content: '‚ñ∂';
            font-size: 12px;
            color: #6b7280;
        }
        
        .icon-edit::after {
            content: '‚úè';
            font-size: 12px;
            color: #9ca3af;
        }
        
        .icon-save::after {
            content: 'üíæ';
            font-size: 12px;
            color: #16a34a;
        }
        
        .icon-cancel::after {
            content: '‚úñ';
            font-size: 12px;
            color: #6b7280;
        }
        
        .icon-settings::after {
            content: '‚öô';
            font-size: 16px;
            color: #6b7280;
        }
        
        .icon-download::after {
            content: '‚¨á';
            font-size: 16px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple icon components to replace Lucide
        const CheckCircle = ({ className }) => (
            <span className={`icon icon-completed ${className}`}></span>
        );
        
        const Circle = ({ className }) => (
            <span className={`icon icon-not-started ${className}`}></span>
        );
        
        const Clock = ({ className }) => (
            <span className={`icon icon-in-progress ${className}`}></span>
        );
        
        const ChevronDown = ({ className }) => (
            <span className={`icon icon-chevron-down ${className}`}></span>
        );
        
        const ChevronRight = ({ className }) => (
            <span className={`icon icon-chevron-right ${className}`}></span>
        );
        
        const Edit2 = ({ className }) => (
            <span className={`icon icon-edit ${className}`}></span>
        );
        
        const Save = ({ className }) => (
            <span className={`icon icon-save ${className}`}></span>
        );
        
        const X = ({ className }) => (
            <span className={`icon icon-cancel ${className}`}></span>
        );
        
        const Settings = ({ className }) => (
            <span className={`icon icon-settings ${className}`}></span>
        );
        
        const Download = ({ className }) => (
            <span className={`icon icon-download ${className}`}></span>
        );

        // GitHub Storage implementation
        const createGitHubStorage = () => {
            let config = JSON.parse(localStorage.getItem('github-config') || '{}');
            
            return {
                async saveConfig(newConfig) {
                    config = { ...config, ...newConfig };
                    localStorage.setItem('github-config', JSON.stringify(config));
                },
                
                async getConfig() {
                    return config;
                },
                
                async save(data) {
                    if (!config.token || !config.owner || !config.repo) {
                        throw new Error('GitHub configuration not set');
                    }
                    
                    const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.filename || 'progress-data.json'}`;
                    
                    try {
                        // Get current file to get SHA
                        const getResponse = await fetch(url, {
                            headers: {
                                'Authorization': `token ${config.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        
                        let sha;
                        if (getResponse.ok) {
                            const fileData = await getResponse.json();
                            sha = fileData.sha;
                        }
                        
                        // Update or create file
                        const response = await fetch(url, {
                            method: 'PUT',
                            headers: {
                                'Authorization': `token ${config.token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message: `Update progress tracker - ${new Date().toISOString()}`,
                                content: btoa(JSON.stringify(data, null, 2)),
                                ...(sha && { sha })
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error(`GitHub API error: ${response.status}`);
                        }
                        
                        return true;
                    } catch (error) {
                        console.error('Save error:', error);
                        throw error;
                    }
                },
                
                async load() {
                    if (!config.token || !config.owner || !config.repo) {
                        throw new Error('GitHub configuration not set');
                    }
                    
                    const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.filename || 'progress-data.json'}`;
                    
                    try {
                        const response = await fetch(url, {
                            headers: {
                                'Authorization': `token ${config.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        
                        if (response.status === 404) {
                            return null;
                        }
                        
                        if (!response.ok) {
                            throw new Error(`GitHub API error: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        const content = atob(data.content);
                        return JSON.parse(content);
                    } catch (error) {
                        console.error('Load error:', error);
                        throw error;
                    }
                }
            };
        };

        const EnhancedProgressTracker = () => {
            const [expandedEpics, setExpandedEpics] = useState({});
            const [editingFeature, setEditingFeature] = useState(null);
            const [epics, setEpics] = useState([]);
            const [loading, setLoading] = useState(true);
            const [saveStatus, setSaveStatus] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [githubConfig, setGithubConfig] = useState({});
            
            const storage = createGitHubStorage();

            // Default epic data structure
            const defaultEpics = [
                {
                    id: 'epic-001',
                    number: 'Enrollment-001',
                    name: 'AccountCreation',
                    description: 'Enable secure client onboarding and access management',
                    journey: 'REGISTER',
                    notes: 'Epic v1.3 completed - Consolidated into single feature document',
                    mvp1Features: [
                        {
                            number: 'Enrollment-001.001',
                            name: 'GuidedOnboardingAccess',
                            description: 'Account creation, login with unique ID, organization pre-population',
                            stories: 25,
                            status: 'completed',
                            notes: 'Consolidated with 001.002 into single comprehensive feature document'
                        }
                    ],
                    mvp2Features: []
                },
                {
                    id: 'epic-002',
                    number: 'Enrollment-002',
                    name: 'AccountManagement',
                    description: 'Enable clients to manage their account data and account lifecycle',
                    journey: 'REGISTER',
                    notes: 'Epic v1.3 completed - Data retention updated from 7 days to 30 days',
                    mvp1Features: [
                        {
                            number: 'Enrollment-002.001',
                            name: 'DataTransparencyRetentionPurging',
                            description: 'Account deletion, data retention (30 days), and purging compliance',
                            stories: 15,
                            status: 'completed',
                            notes: 'Updated: Data retention changed from 7 days to 30 days'
                        }
                    ],
                    mvp2Features: []
                },
                {
                    id: 'epic-003',
                    number: 'Enrollment-003',
                    name: 'FileUploadIngestion',
                    description: 'Core platform capability for securely uploading, validating, and processing files',
                    journey: 'SCORE (FREE & PAID)',
                    notes: 'Epic v1.3 completed - All MVP 1 & 2 features documented',
                    mvp1Features: [
                        {
                            number: 'Enrollment-003.001',
                            name: 'FileUploadManagement',
                            description: 'Secure upload with progress tracking and validation',
                            stories: 16,
                            status: 'completed',
                            notes: 'v1.1 - PHI attestation and upload flow optimization'
                        },
                        {
                            number: 'Enrollment-003.002',
                            name: 'FileStandardization',
                            description: 'AI-powered file standardization to 834 EDI format',
                            stories: 23,
                            status: 'completed',
                            notes: 'v3.0 - Documentation Standards optimization with AI field mapping'
                        },
                        {
                            number: 'Enrollment-003.003',
                            name: 'ProgressTrackingNotification',
                            description: 'Real-time progress tracking and email notifications',
                            stories: 13,
                            status: 'completed',
                            notes: 'v1.2 - Complete progress tracking with dashboard and notifications'
                        }
                    ],
                    mvp2Features: [
                        {
                            number: 'Enrollment-003.004',
                            name: 'IdentifiedFileUpload',
                            description: 'Identified data upload with PHI handling for Fix tier',
                            stories: 11,
                            status: 'completed',
                            notes: 'v1.1 - Fix tier PHI file upload with enhanced security'
                        }
                    ]
                },
                {
                    id: 'epic-004',
                    number: 'Enrollment-004',
                    name: 'DataQualityScoring',
                    description: 'Comprehensive analysis and scoring of data quality issues',
                    journey: 'SCORE (FREE & PAID)',
                    notes: 'Epic v1.2 completed - Error detection and scoring dashboard',
                    mvp1Features: [
                        {
                            number: 'Enrollment-004.001',
                            name: 'ScoringBreakdown',
                            description: 'Detailed scoring dashboard with error categorization',
                            stories: 20,
                            status: 'completed',
                            notes: 'Comprehensive dashboard with four-category error taxonomy and cost breakdown'
                        }
                    ],
                    mvp2Features: [
                        {
                            number: 'Enrollment-004.002',
                            name: 'CostCalculator',
                            description: 'Business impact calculator for data quality issues',
                            stories: 12,
                            status: 'in-progress',
                            notes: 'Cost modeling framework in development'
                        }
                    ]
                },
                {
                    id: 'epic-005',
                    number: 'Enrollment-005',
                    name: 'AutomatedCorrection',
                    description: 'AI-powered automatic correction of common data quality issues',
                    journey: 'FIX (PAID)',
                    notes: 'Epic completed - AI correction engine foundation',
                    mvp1Features: [],
                    mvp2Features: [
                        {
                            number: 'Enrollment-005.001',
                            name: 'CorrectionEngine',
                            description: 'AI-powered correction generation and validation',
                            stories: 15,
                            status: 'completed',
                            notes: 'AI correction engine with confidence scoring and validation'
                        }
                    ]
                },
                {
                    id: 'epic-006',
                    number: 'Enrollment-006',
                    name: 'CorrectionReviewManagement',
                    description: 'User interface for reviewing and approving AI-generated corrections',
                    journey: 'FIX (PAID)',
                    notes: 'Epic completed - Complete correction review workflow with toggle interface and transparency',
                    mvp1Features: [],
                    mvp2Features: [
                        {
                            number: 'Enrollment-006.001',
                            name: 'FixReviewInterface',
                            description: 'Interactive interface for reviewing and selecting corrections with toggle controls',
                            stories: 20,
                            status: 'completed',
                            notes: 'v1.1 - Complete toggle interface with "Apply fix" labels, error category chips, and record-level overrides'
                        },
                        {
                            number: 'Enrollment-006.002',
                            name: 'FixResults',
                            description: 'Post-correction summary with complete error transparency and download options',
                            stories: 14,
                            status: 'completed',
                            notes: 'v1.2 - Complete error breakdown cards, deselected records table, and dynamic metrics based on user selections'
                        }
                    ]
                },
                {
                    id: 'epic-007',
                    number: 'Enrollment-007',
                    name: 'ManualReviewManagement',
                    description: 'Tools for manual correction of complex data quality issues',
                    journey: 'MANAGE (PAID)',
                    notes: '',
                    mvp1Features: [],
                    mvp2Features: [
                        {
                            number: 'Enrollment-007.001',
                            name: 'ManualCorrectionInterface',
                            description: 'User interface for manual data correction and validation',
                            stories: 16,
                            status: 'not-started',
                            notes: ''
                        }
                    ]
                },
                {
                    id: 'epic-008',
                    number: 'Enrollment-008',
                    name: 'FileExportDelivery',
                    description: 'Export and delivery of corrected files in required formats',
                    journey: 'FIX & MANAGE (PAID)',
                    notes: '',
                    mvp1Features: [],
                    mvp2Features: [
                        {
                            number: 'Enrollment-008.001',
                            name: 'CorrectedFileExport',
                            description: 'Export corrected 834 EDI files and error reports',
                            stories: 8,
                            status: 'not-started',
                            notes: ''
                        }
                    ]
                },
                {
                    id: 'epic-009',
                    number: 'Enrollment-009',
                    name: 'ComplianceAuditReporting',
                    description: 'Comprehensive audit trails and compliance reporting',
                    journey: 'ALL TIERS',
                    notes: '',
                    mvp1Features: [
                        {
                            number: 'Enrollment-009.001',
                            name: 'AuditTrailGeneration',
                            description: 'Comprehensive audit trail capture and storage',
                            stories: 7,
                            status: 'not-started',
                            notes: ''
                        }
                    ],
                    mvp2Features: [
                        {
                            number: 'Enrollment-009.002',
                            name: 'ComplianceReporting',
                            description: 'Regulatory compliance reports and documentation',
                            stories: 9,
                            status: 'not-started',
                            notes: ''
                        }
                    ]
                }
            ];

            // Dynamic Epic Status Calculation
            const calculateEpicStatus = (epic) => {
                const allFeatures = [...epic.mvp1Features, ...epic.mvp2Features];
                
                if (allFeatures.length === 0) {
                    return 'not-started';
                }
                
                const completedFeatures = allFeatures.filter(f => f.status === 'completed');
                const inProgressFeatures = allFeatures.filter(f => f.status === 'in-progress');
                
                if (completedFeatures.length === allFeatures.length) {
                    return 'completed';
                } else if (completedFeatures.length > 0 || inProgressFeatures.length > 0) {
                    return 'in-progress';
                } else {
                    return 'not-started';
                }
            };

            const updateEpicsWithCalculatedStatus = (epicsData) => {
                return epicsData.map(epic => ({
                    ...epic,
                    status: calculateEpicStatus(epic)
                }));
            };

            useEffect(() => {
                loadData();
                loadGitHubConfig();
            }, []);

            const loadGitHubConfig = async () => {
                try {
                    const config = await storage.getConfig();
                    setGithubConfig(config);
                } catch (error) {
                    console.error('Failed to load GitHub config:', error);
                }
            };

            const loadData = async () => {
                try {
                    setSaveStatus('Loading...');
                    const data = await storage.load();
                    
                    if (data && data.epics) {
                        const epicsWithStatus = updateEpicsWithCalculatedStatus(data.epics);
                        setEpics(epicsWithStatus);
                        setExpandedEpics(data.expandedEpics || {});
                        setSaveStatus('‚úÖ Loaded from GitHub');
                    } else {
                        const epicsWithStatus = updateEpicsWithCalculatedStatus(defaultEpics);
                        setEpics(epicsWithStatus);
                        setSaveStatus('üìù Using default data');
                        await saveData(epicsWithStatus, {});
                    }
                } catch (error) {
                    console.error('Load failed:', error);
                    const epicsWithStatus = updateEpicsWithCalculatedStatus(defaultEpics);
                    setEpics(epicsWithStatus);
                    setSaveStatus('‚ùå Failed to load from GitHub - using local data');
                } finally {
                    setLoading(false);
                }
            };

            const saveData = async (epicsData, expandedData) => {
                try {
                    setSaveStatus('Saving...');
                    const dataToSave = {
                        epics: epicsData,
                        expandedEpics: expandedData,
                        lastUpdated: new Date().toISOString()
                    };
                    
                    await storage.save(dataToSave);
                    setSaveStatus('‚úÖ Saved to GitHub');
                    
                    setTimeout(() => setSaveStatus(''), 3000);
                } catch (error) {
                    console.error('Save failed:', error);
                    setSaveStatus('‚ùå Save failed');
                    setTimeout(() => setSaveStatus(''), 5000);
                }
            };

            const updateFeatureStatus = async (epicId, featureNumber, newStatus, mvpType) => {
                const updatedEpics = epics.map(epic => {
                    if (epic.id === epicId) {
                        const updateFeatures = (features) => 
                            features.map(feature => 
                                feature.number === featureNumber 
                                    ? { ...feature, status: newStatus }
                                    : feature
                            );

                        return {
                            ...epic,
                            mvp1Features: mvpType === 'mvp1' ? updateFeatures(epic.mvp1Features) : epic.mvp1Features,
                            mvp2Features: mvpType === 'mvp2' ? updateFeatures(epic.mvp2Features) : epic.mvp2Features
                        };
                    }
                    return epic;
                });

                const epicsWithCalculatedStatus = updateEpicsWithCalculatedStatus(updatedEpics);
                setEpics(epicsWithCalculatedStatus);
                await saveData(epicsWithCalculatedStatus, expandedEpics);
            };

            const updateFeatureNotes = async (epicId, featureNumber, newNotes, mvpType) => {
                const updatedEpics = epics.map(epic => {
                    if (epic.id === epicId) {
                        const updateFeatures = (features) => 
                            features.map(feature => 
                                feature.number === featureNumber 
                                    ? { ...feature, notes: newNotes }
                                    : feature
                            );

                        return {
                            ...epic,
                            mvp1Features: mvpType === 'mvp1' ? updateFeatures(epic.mvp1Features) : epic.mvp1Features,
                            mvp2Features: mvpType === 'mvp2' ? updateFeatures(epic.mvp2Features) : epic.mvp2Features
                        };
                    }
                    return epic;
                });

                setEpics(updatedEpics);
                await saveData(updatedEpics, expandedEpics);
            };

            const toggleEpic = (epicId, event) => {
                if (event) {
                    event.stopPropagation();
                }
                
                const newExpandedEpics = {
                    ...expandedEpics,
                    [epicId]: !expandedEpics[epicId]
                };
                
                setExpandedEpics(newExpandedEpics);
                saveData(epics, newExpandedEpics);
            };

            const getStatusIcon = (status) => {
                switch(status) {
                    case 'completed':
                        return React.createElement(CheckCircle, { className: "w-5 h-5 text-green-600" });
                    case 'in-progress':
                        return React.createElement(Clock, { className: "w-5 h-5 text-blue-600" });
                    case 'not-started':
                        return React.createElement(Circle, { className: "w-5 h-5 text-gray-400" });
                    default:
                        return React.createElement(Circle, { className: "w-5 h-5 text-yellow-600" });
                }
            };

            const getStatusColor = (status) => {
                const colors = {
                    'completed': 'bg-green-100 text-green-800',
                    'in-progress': 'bg-blue-100 text-blue-800',
                    'not-started': 'bg-gray-100 text-gray-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            };

            const calculateProgress = () => {
                const allFeatures = epics.flatMap(e => [...e.mvp1Features, ...e.mvp2Features]);
                const completed = allFeatures.filter(f => f.status === 'completed').length;
                const total = allFeatures.length;
                return { completed, total, percentage: Math.round((completed / total) * 100) };
            };

            const saveGitHubConfig = async (config) => {
                await storage.saveConfig(config);
                setGithubConfig(config);
                setShowSettings(false);
            };

            const exportData = () => {
                const dataToExport = {
                    epics,
                    expandedEpics,
                    exportedAt: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `enrollment-progress-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            if (loading) {
                return (
                    <div className="max-w-7xl mx-auto p-6 bg-gray-50">
                        <div className="flex items-center justify-center h-64">
                            <div className="text-lg text-gray-600">Loading progress tracker...</div>
                        </div>
                    </div>
                );
            }

            const progress = calculateProgress();

            return (
                <div className="max-w-7xl mx-auto p-6 bg-gray-50">
                    {/* Header */}
                    <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                        <div className="flex items-center justify-between mb-4">
                            <div>
                                <h1 className="text-3xl font-bold text-gray-900 mb-2">
                                    Enhanced Enrollment Progress Tracker
                                </h1>
                                <p className="text-gray-600">
                                    Epic, Feature, and User Story mapping for MVP releases with dynamic status tracking
                                </p>
                            </div>
                            <div className="flex items-center space-x-2">
                                {saveStatus && (
                                    <span className="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                                        {saveStatus}
                                    </span>
                                )}
                                <button
                                    onClick={exportData}
                                    className="p-2 text-gray-600 hover:bg-gray-100 rounded-full"
                                    title="Export data"
                                >
                                    <Download className="w-5 h-5" />
                                </button>
                                <button
                                    onClick={() => setShowSettings(true)}
                                    className="p-2 text-gray-600 hover:bg-gray-100 rounded-full"
                                    title="Settings"
                                >
                                    <Settings className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                        
                        {/* Overall Progress */}
                        <div className="bg-blue-50 rounded-lg p-4">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-sm font-semibold text-gray-700">Overall Progress</span>
                                <span className="text-sm font-semibold text-blue-700">
                                    {progress.completed} of {progress.total} features completed ({progress.percentage}%)
                                </span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-3">
                                <div 
                                    className="bg-blue-600 h-3 rounded-full progress-bar-animate"
                                    style={{ width: `${progress.percentage}%` }}
                                />
                            </div>
                        </div>
                    </div>

                    {/* Instructions */}
                    <div className="bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 rounded">
                        <h3 className="font-semibold text-amber-900 mb-2">üìù Enhancements in This Version:</h3>
                        <ul className="list-disc list-inside text-amber-800 space-y-1 text-sm">
                            <li><strong>Dynamic Epic Status:</strong> Epic status now automatically updates based on feature completion</li>
                            <li><strong>Fixed Accordion Behavior:</strong> Status changes no longer collapse accordions</li>
                            <li><strong>GitHub Integration:</strong> All changes automatically sync to your repository</li>
                            <li><strong>Custom Icons:</strong> Replaced external icon library with reliable custom icons</li>
                        </ul>
                    </div>

                    {/* Epics */}
                    <div className="space-y-4">
                        {epics.map((epic) => (
                            <div key={epic.id} className="bg-white rounded-lg shadow-sm border">
                                <div 
                                    className="p-4 cursor-pointer hover:bg-gray-50 epic-status-transition"
                                    onClick={(e) => toggleEpic(epic.id, e)}
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center space-x-3">
                                            {expandedEpics[epic.id] ? 
                                                <ChevronDown className="w-5 h-5 text-gray-500" /> : 
                                                <ChevronRight className="w-5 h-5 text-gray-500" />
                                            }
                                            {getStatusIcon(epic.status)}
                                            <div>
                                                <div className="flex items-center space-x-2">
                                                    <h3 className="text-lg font-semibold text-gray-900">{epic.number}</h3>
                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium epic-status-transition ${getStatusColor(epic.status)}`}>
                                                        {epic.status.replace('-', ' ')}
                                                    </span>
                                                    <span className="text-sm text-gray-500">({epic.journey})</span>
                                                </div>
                                                <p className="text-sm text-gray-600">{epic.name}</p>
                                                <p className="text-xs text-gray-500 mt-1">{epic.description}</p>
                                            </div>
                                        </div>
                                        <div className="text-right text-sm text-gray-500">
                                            <div>MVP1: {epic.mvp1Features.length} features</div>
                                            <div>MVP2: {epic.mvp2Features.length} features</div>
                                        </div>
                                    </div>
                                    
                                    {epic.notes && (
                                        <div className="mt-2 pl-8">
                                            <p className="text-xs text-blue-600 italic">{epic.notes}</p>
                                        </div>
                                    )}
                                </div>

                                {expandedEpics[epic.id] && (
                                    <div className="border-t bg-gray-50 p-4 space-y-4">
                                        {epic.mvp1Features.length > 0 && (
                                            <div>
                                                <h4 className="font-medium text-gray-900 mb-2">MVP 1 Features</h4>
                                                <div className="space-y-2">
                                                    {epic.mvp1Features.map((feature, index) => (
                                                        <FeatureCard 
                                                            key={index}
                                                            feature={feature}
                                                            epicId={epic.id}
                                                            mvpType="mvp1"
                                                            onStatusUpdate={updateFeatureStatus}
                                                            onNotesUpdate={updateFeatureNotes}
                                                            editingFeature={editingFeature}
                                                            setEditingFeature={setEditingFeature}
                                                            getStatusIcon={getStatusIcon}
                                                            getStatusColor={getStatusColor}
                                                        />
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {epic.mvp2Features.length > 0 && (
                                            <div>
                                                <h4 className="font-medium text-gray-900 mb-2">MVP 2 Features</h4>
                                                <div className="space-y-2">
                                                    {epic.mvp2Features.map((feature, index) => (
                                                        <FeatureCard 
                                                            key={index}
                                                            feature={feature}
                                                            epicId={epic.id}
                                                            mvpType="mvp2"
                                                            onStatusUpdate={updateFeatureStatus}
                                                            onNotesUpdate={updateFeatureNotes}
                                                            editingFeature={editingFeature}
                                                            setEditingFeature={setEditingFeature}
                                                            getStatusIcon={getStatusIcon}
                                                            getStatusColor={getStatusColor}
                                                        />
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>

                    {/* Summary Statistics */}
                    <div className="mt-6 bg-white rounded-lg shadow-sm p-6">
                        <h2 className="text-xl font-semibold text-gray-900 mb-4">Summary</h2>
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div className="bg-gray-50 rounded-lg p-4">
                                <div className="text-2xl font-bold text-gray-900">9</div>
                                <div className="text-sm text-gray-600">Total Epics</div>
                            </div>
                            <div className="bg-green-50 rounded-lg p-4">
                                <div className="text-2xl font-bold text-green-700">
                                    {epics.flatMap(e => e.mvp1Features).length}
                                </div>
                                <div className="text-sm text-gray-600">MVP 1 Features</div>
                            </div>
                            <div className="bg-blue-50 rounded-lg p-4">
                                <div className="text-2xl font-bold text-blue-700">
                                    {epics.flatMap(e => e.mvp2Features).length}
                                </div>
                                <div className="text-sm text-gray-600">MVP 2 Features</div>
                            </div>
                            <div className="bg-purple-50 rounded-lg p-4">
                                <div className="text-2xl font-bold text-purple-700">
                                    {epics.flatMap(e => [...e.mvp1Features, ...e.mvp2Features]).length}
                                </div>
                                <div className="text-sm text-gray-600">Total Features</div>
                            </div>
                        </div>
                        
                        <div className="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="bg-green-50 rounded-lg p-4">
                                <div className="text-2xl font-bold text-green-700">
                                    {epics.filter(e => e.status === 'completed').length}
                                </div>
                                <div className="text-sm text-gray-600">Epics Completed</div>
                            </div>
                            <div className="bg-blue-50 rounded-lg p-4">
                                <div className="text-2xl font-bold text-blue-700">{progress.completed}</div>
                                <div className="text-sm text-gray-600">Features Completed</div>
                            </div>
                            <div className="bg-purple-50 rounded-lg p-4">
                                <div className="text-2xl font-bold text-purple-700">
                                    {epics.flatMap(e => [...e.mvp1Features, ...e.mvp2Features])
                                        .filter(f => f.status === 'completed')
                                        .reduce((sum, f) => sum + f.stories, 0)}
                                </div>
                                <div className="text-sm text-gray-600">Total Stories (Completed)</div>
                            </div>
                        </div>
                    </div>

                    {/* Settings Modal */}
                    {showSettings && (
                        <SettingsModal 
                            config={githubConfig}
                            onSave={saveGitHubConfig}
                            onClose={() => setShowSettings(false)}
                        />
                    )}

                    {/* Footer */}
                    <div className="mt-6 text-center text-sm text-gray-500">
                        <p>Last Updated: {new Date().toLocaleDateString()}</p>
                        <p className="mt-1">Enhanced Version - Fixed Library Dependencies</p>
                        <p className="mt-1">üíæ All changes automatically synced to GitHub</p>
                    </div>
                </div>
            );
        };

        // Feature Card Component
        const FeatureCard = ({ 
            feature, 
            epicId, 
            mvpType, 
            onStatusUpdate, 
            onNotesUpdate, 
            editingFeature, 
            setEditingFeature,
            getStatusIcon,
            getStatusColor
        }) => {
            const [tempNotes, setTempNotes] = useState(feature.notes);

            const handleStatusClick = (e) => {
                e.stopPropagation();
                e.preventDefault();
                
                const statuses = ['not-started', 'in-progress', 'completed'];
                const currentIndex = statuses.indexOf(feature.status);
                const nextStatus = statuses[(currentIndex + 1) % statuses.length];
                onStatusUpdate(epicId, feature.number, nextStatus, mvpType);
            };

            const handleEditNotes = (e) => {
                e.stopPropagation();
                setEditingFeature(feature.number);
                setTempNotes(feature.notes);
            };

            const handleSaveNotes = (e) => {
                e.stopPropagation();
                onNotesUpdate(epicId, feature.number, tempNotes, mvpType);
                setEditingFeature(null);
            };

            const handleCancelEdit = (e) => {
                e.stopPropagation();
                setTempNotes(feature.notes);
                setEditingFeature(null);
            };

            const isEditing = editingFeature === feature.number;

            return (
                <div className="bg-white rounded border p-3">
                    <div className="flex items-start justify-between">
                        <div className="flex items-start space-x-2">
                            {getStatusIcon(feature.status)}
                            <div className="flex-1">
                                <div className="flex items-center space-x-2">
                                    <h5 className="font-medium text-gray-900">{feature.number}</h5>
                                    <button
                                        onClick={handleStatusClick}
                                        className={`px-3 py-1 rounded-full text-xs font-medium border transition-all duration-200 status-button-hover ${getStatusColor(feature.status)}`}
                                        title="Click to cycle through status"
                                    >
                                        {feature.status.replace('-', ' ')}
                                    </button>
                                </div>
                                <p className="text-sm text-gray-600">{feature.name}</p>
                                <p className="text-xs text-gray-500 mt-1">{feature.description}</p>
                            </div>
                        </div>
                        <div className="text-right text-xs text-gray-500">
                            <span>Stories: {feature.stories}</span>
                        </div>
                    </div>
                    
                    {/* Notes Section */}
                    <div className="mt-2">
                        {isEditing ? (
                            <div className="flex items-start space-x-2">
                                <textarea
                                    value={tempNotes}
                                    onChange={(e) => setTempNotes(e.target.value)}
                                    onClick={(e) => e.stopPropagation()}
                                    className="flex-1 text-xs p-2 border rounded resize-none"
                                    rows="2"
                                    placeholder="Add notes..."
                                />
                                <div className="flex flex-col space-y-1">
                                    <button
                                        onClick={handleSaveNotes}
                                        className="p-1 text-green-600 hover:bg-green-50 rounded"
                                        title="Save"
                                    >
                                        <Save className="w-3 h-3" />
                                    </button>
                                    <button
                                        onClick={handleCancelEdit}
                                        className="p-1 text-gray-600 hover:bg-gray-50 rounded"
                                        title="Cancel"
                                    >
                                        <X className="w-3 h-3" />
                                    </button>
                                </div>
                            </div>
                        ) : (
                            <div className="flex items-start justify-between">
                                {feature.notes ? (
                                    <p className="text-xs text-blue-600 italic flex-1">{feature.notes}</p>
                                ) : (
                                    <p className="text-xs text-gray-400 italic flex-1">No notes</p>
                                )}
                                <button
                                    onClick={handleEditNotes}
                                    className="ml-2 p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded"
                                    title="Edit notes"
                                >
                                    <Edit2 className="w-3 h-3" />
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Settings Modal Component
        const SettingsModal = ({ config, onSave, onClose }) => {
            const [formData, setFormData] = useState({
                token: config.token || '',
                owner: config.owner || '',
                repo: config.repo || '',
                filename: config.filename || 'progress-data.json'
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg p-6 w-full max-w-md">
                        <h2 className="text-lg font-semibold mb-4">GitHub Configuration</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Personal Access Token
                                </label>
                                <input
                                    type="password"
                                    value={formData.token}
                                    onChange={(e) => setFormData({...formData, token: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"
                                    placeholder="ghp_..."
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    GitHub Username
                                </label>
                                <input
                                    type="text"
                                    value={formData.owner}
                                    onChange={(e) => setFormData({...formData, owner: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"
                                    placeholder="your-username"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Repository Name
                                </label>
                                <input
                                    type="text"
                                    value={formData.repo}
                                    onChange={(e) => setFormData({...formData, repo: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"
                                    placeholder="enrollment-progress-tracker"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Data Filename
                                </label>
                                <input
                                    type="text"
                                    value={formData.filename}
                                    onChange={(e) => setFormData({...formData, filename: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"
                                    placeholder="progress-data.json"
                                    required
                                />
                            </div>
                            <div className="flex justify-end space-x-2 pt-4">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700"
                                >
                                    Save
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<EnhancedProgressTracker />, document.getElementById('root'));
    </script>
</body>
</html>
